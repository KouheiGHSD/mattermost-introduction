# Mattermostとは
MattermostはアメリカのMattermost Inc社が開発しているチャットアプリケーションです。公式に`Open source, private cloud Slack-alternative`を掲げており、自社内の環境にSlackのようなチャット基盤を構築できることを売りにしています。MattermostのソースコードはGitHub上に公開されており、誰でも自由に開発に参加することができるようになっています。

今回はMattermostを使用している社内の事例や、Mattermotの基本的な機能について紹介します。

## チャットツール
数年前、チャットツールとBotを連携して開発生産性を高めるChatOpsという手法がエンジニアの間でブームとなりました。
当時、無料で使い始めることのできるSlackをチャット基盤として、GitHub社のHubotを利用して様々なサービスと繋げるChatOpsの事例が数多く報告されました。

今日では、チャット基盤を構築しようとしたときに有償・無償、またはオープンソースのチャットツールを含め様々な選択肢があります。

今回紹介するMattermostのようなオープンソースのチャットツールは、SlackやStrideなどのSaaS型のサービスと違って自社内に基盤を構築できるためデータを自分たちのコントロール下に置くことができます。これによりデータの再利用が容易に行えたり、複雑な組織のコンプライアンスに合わせてカスタマイズがしやすいという点が挙げられます。
また、HipChatやMicrosoft Teamのようなオンプレミス環境でセットアップ可能な製品もありますが、オープンソースとして公開されているMattermostのように、開発者と直接対話をしながらバグフィックスや新機能の提案などを行うことはできません。

また、現在ではオープンソースのチャットツールも数多くリリースされています。
Rocket.chatやZulip、riotなど　GitHubのスターも数千〜数万ついている有名なもの多くありますが、その中でも私がMattermostの強みだと思っているのは、エンタープライズという組織への理解がある点だと思います。有償版のみの機能となりますが、チャンネルや投稿の作成/修正/削除などの権限設定をUI上から簡単に設定できたり、アクティビティを定期的に保存できるコンプライアンスエクスポートの機能が使えるようになるなど、エンタープライズ向けの機能も数多く揃えており、大企業での利用を想定した機能追加が行われています。
Uber社も、SlackやHipChatの利用をあきらめ、Mattermostをベースとした独自のコミュニケーション基盤としてuChatの開発を進めていると公言しており、今後さらに使いやすくなっていくはずです。

### (コラム) Mattermost v5.0
2018/6/15にMattermostの１年ぶりのメジャーバージョンアップ版Mattermost v5.0.0がリリースされました。

このアップデートでは、プラグイン開発時に利用できるAPIとして投稿をフックして動作するAPIが追加されました。これにより、不適切な言葉を含む投稿のフィルタリングや、アクセスキーなどの秘密情報を検知してデータベースに書き込む前に書き換えることなどを行えるようになりました。
また、一つの投稿に含むことのできる文字数が4,000文字から16,383文字に拡張されています。MattermostではMarkdown形式で投稿を行うことができるため、大きなテーブルを投稿する際などに、この最大文字数の拡張が有効になります。以前のバージョンからアップデートした場合、主導でデータベースのスキーマを変更する必要があります。

## Mattermostを動かしてみよう
ここからはDockerを使ってMattermostを実際に動かしてみます。

Mattermostは、1行のコマンドでMattermostを立ち上げられるプレビュー用のDockerイメージが用意されています。
Dockerがインストールされた環境で下記のコマンドを実行してみてください。

```
docker run --name mattermost-preview -d --publish 8065:8065 mattermost/mattermost-preview
```

コマンド実行後 http://localhost:8065 にブラウザでアクセスすると、Mattermostのトップ画面が表示されるはずです。

![Top](./images/setup.png)

### 初期設定
Mattermostにアクセスできたら、画面の表示に従って管理者用アカウントのメールアドレス、ユーザー名、パスワードを入力し、`Create Account`のボタンを押すと管理者用のアカウントが作成されます。

この時点ではMattermostのチームが作成されていないため、まずチームを作成する必要があります。
`Create a new team`ボタンを押すとチーム作成画面が表示され、画面の指示通りチーム名、チームURLと入力していくとチャット画面が表示されます。

#### 画面の日本語化
Mattermostでは画面メニューなどの国際化が行われており、日本語でMattermost画面を表示することができます。
画面の日本語化を行うには、まず、画面左上にあるハンバーガーメニューをクリックして出現するメインメニューから`Account Settings`をクリックし、アカウント設定画面を開きます。

![Account Settings](./images/move_to_accountsettings.png)

アカウント設定画面で `Display` > `Language` をクリックし、セレクトボックスから`日本語`を選択して`Save`ボタンを押すと画面が日本語化されます。

### 投稿
実際にメッセージを投稿してみましょう。
この時点で、画面にチュートリアルが表示されている場合はチュートリアルを進めておいてください。

Mattermostでは、画面中央下にある入力欄にメッセージを書き込み、Enterボタンを押すことでメッセージを投稿できます。

![Messaging](./images/message_inputbox.png)

Markdown形式に対応しているため、下記のようなメッセージを投稿することで修飾されたメッセージを投稿できるようになります。

```
# テストメッセージ
これはテスト用のメッセージです。

* テスト１
* テスト２
* テスト３
```

Mattermostで使用できるMarkdown形式については、メッセージ入力欄の右下にある`ヘルプ`から確認することができます。

#### ファイル添付
添付したいファイルを画面上にドラッグ＆ドロップすると、投稿にファイルを添付することができます。

#### メンション
誰かに対するメッセージを送りたい場合、`@ユーザー名`で特定のユーザーに対するメンションを送ることができます。
メンションされたユーザーには、その投稿が画面上で目立つように表示されたり、メールサーバーが設定されている場合はメール通知を送ることができます。

#### ハッシュタグ
Twitterなどと同じように、`#`のあとに３文字以上の言葉を続けることでハッシュタグを作成できます。日本語のハッシュタグも作成できます。(例: `#日本語`)
ハッシュタグは自動でリンクとなり、そのリンクをクリックすると同じハッシュタグを持つ投稿を一覧することができます。

#### フラグ
後から見返したい有用なメッセージにはフラグを付けることができます。
フラグを付けたメッセージは、右上のフラグボタンから確認することができます。

#### ピン留め
投稿をピン留めしておくことで、チャンネル固有のメッセージを指定することができます。ピン留めされた投稿は右上のピンボタンから確認することができます。
新しくチャンネルに参加した人に見ておいて欲しいメッセージなどをピン留めしておくと便利です。

#### 絵文字リアクション
投稿に対して絵文字を使ったリアクションを付けることができます。
Mattermostでは`+:${絵文字ID}:`というメッセージを投稿することで、直前のメッセージに対して絵文字リアクションをつけることもできます。マウス操作をしたくない時に便利です。

### (コラム)メールにはない絵文字リアクション機能
この機能はコミュニケーションツールとしてチャットを利用する際の大きな利点の一つです。
今までのメールによるコミュニケーションの場合、複数人に送ったメールがちゃんと読まれたかを確認するには、全員に返信をしてもらい、その返信の数をチェックする必要がありました。しかし、絵文字リアクションの機能を使うことによって、とても簡単に既読だということを表現することができ、また、何人がメッセージを確認したのかを手軽に知ることができます。
また、「ありがとう」と言葉で書くよりも気軽にポジティブな気持ちを表現することができます。

チャットを導入する際は、積極的に絵文字リアクションをつけて行きましょう。

![emoji reaction](./images/emoji_reaction.png)

### チャンネル
チャンネルは基本的にメッセージが一つのスレッド上でやり取りされるため、１チャンネルで様々なやり取りを行うと会話の履歴を追うのが大変になってきます。
そのために、会話したいテーマごとにチャンネルを作成することをお勧めします。

また、Mattermostには公開チャンネル、非公開チャンネル、ダイレクトメッセージの３種類のチャンネルがあるので、基本的には公開チャンネル、関係社外秘の情報をやり取りするには非公開チャンネル、プライベートの相談などをしたい場合はダイレクトメッセージ、のように用途によって使い分けることができます。

基本は全て公開チャンネルとしてやり取りを行う方が、興味がある人が自由に会話に参加できるため情報格差が無くなりやすくなります。

#### チャンネルの作成
実際にチャンネルを作成するには、左サイドバーの各チャンネル種別の隣に表示されている`+`ボタンをクリックすることでチャンネル作成メニューを開くことができます。

`名前`にはチャンネル名を入力します。
`目的`は、ユーザーが参加するチャンネルを選択するメニューに表示されるテキストとして使用されるため、チャンネルの簡単な説明を入力してください。
`ヘッダー`は、チャンネルの上部メニューに常に表示されるテキストです。

### チーム
Mattermostではチャンネルより大きい単位として、`チーム`が存在します。
`チーム`はメインメニューの`新しいチームを作成する`メニューから作成することができます。

#### メンバーを招待する
新しく作成したばかりのチームには他のユーザーがいないため、ユーザーを招待する必要があります。
ユーザーを招待するには、招待メールを送信する、チーム招待リンクからアクセスしてもらう、すでに別チームに参加するためにアカウント作成済みのユーザーを新しく作成したチームに追加する、の３つの方法があります。

この中で最も手軽なのが`チーム招待リンクを入手`です。
このメニューをクリックするとチームに参加するためのリンクが生成されるため、このURLをコピペして参加してほしい人に送ったり、ポータルサイトに載せておいたりすることで、チームに参加してもらうことができるようになります。

### (コラム) チーム・チャンネルの分け方について
チャットを使い始めると、チームやチャンネルをどのように分けるのかを考えることになると思います。
その分け方に正解はありませんが、最も避けなくてはいけない状況は、チャットの場が閑散としコミュニケーションが生まれなくなってしまうことだと思います。

#### チームの分け方について
組織でコミュニケーションツールを導入する際は組織の分かれ目と同じようにチームを分けてしまいたくなりますが、それだと結局顔を合わせる人たちだけの繋がりとなってしまい、離れた場所にいる人同士の意外な繋がりから生まれるシナジーを消してしまうことになります。
Mattermostでは特定のユーザーだけでやり取りをするための非公開チャンネルの機能もあるので、チームの単位はなるべく大きく区切り、様々な背景の人が一堂に参加する場を作ることをお勧めします。

#### チャンネルの分け方
私の周りでは、プロジェクト内の連絡用のチャンネルの他に、メンバーそれぞれが自由に呟くための個人チャンネルを作成することが多いです。
仕事のことだけでなく、技術情報や事務手続き、またはプライベートのことまで自由に発言し、興味のある人が発言を重ねていくことでチーム内の知識や認識を共有できるというメリットがあります。
皆が悩んでいることや嬉しかったことを気軽に呟ける場所を用意することで、今までのコミュニケーションでは見えなかったものが見えてくるはずです。

## 弊社でのMattermost活用状況

ここまではmattermostの使い方について書いてきましたが、ここからはchatを利用し始めてから組織がどのように変わったか、私達の事例についてお伝えします。

まず、私達のchat利用度合いですが、利用開始から9ヶ月程度で以下のようになっています。

総投稿数：
チャンネル数：
アクティブユーザ数：
日次投稿平均数：

chatの利用者は、開発チーム/拡販チーム/保守サポートチームといった役割が異なるメンバーになっており、chat開始以前とは比べ物にならないほど交流が行われるようになりました。今では、業務を円滑に行うためにchatが無い状況は考えられなくなっています。

chatで得られた大きな効果をまとめると「オープンな会話による情報共有効率化」「非同期な会話による時間効率化」「フラットな関係性による議論促進」の3点になります。

まず1つ目ですが、当組織でのchatは全てのチャンネルをpublicかつ自由参加にしています。仕事上の会話は公開範囲を出来る限り広くして、誰でも見られることが望ましいと考えています。それにより組織間の無駄な壁が薄くなります。他チームと連携する際、chat利用以前では、調整や資料作成、打ち合わせを実施するためそれなりにコストをかけて居たことがchatを利用するようになってから実感しました。

2つ目は非同期な会話です。chatを使い始めてから会議の開催回数が大幅に減りました（20%程度削減、なおメールは30%程度削減）。今まではちょっとした検討も打ち合わせを実施していましたが、打ち合わせは瞬発力が高い人や外交的な人が支配しがちで、じっくり考える人には向いて居なかったりします。chatのように自分の時間軸で物事に向き合って対応したほうが良いケースはたくさんあり、より効率的に会話が行える様になりました。ただ、自然に打ち合わせがchatに移行していくことはなく、chat推進者が都度chatへの誘導を地道に唱え続けました。

最後の3つ目、フラットな関係性はchatが文字列のみのやりとりであるというデメリットを逆手に取った考え方になります。対面でのコミュニケーションはその場の空気や振る舞いにより言葉以上のものを伝えることが出来ます。これは交渉や説得において有効に働きますが、純粋な議論では逆に働いてしまうことがあります。声の大きい人による圧力や、職制の力が方向性を決めてしまうことはよくあるでしょう。オープンなチャットでは不特定多数が見ていることもあり、空気を利用した議論誘導は難しくなります。議題に向き合うことが可能になります。それまで一部の当事者がなんとなく決めていたことを、複数の意見を取り入れ、より建設的な議論に出来たケースが何度もありました。


さて、これまでchatを利用した時の良いことを列挙してきましたが、現在の運用が簡単に実現したわけではありません。最近のchatはインタフェースに優れ、非常に使いやすくなっていますが、使い始めただけで自然に組織に定着するものとは言えません。

特に組織が大きかったり、歴史を持っていると、新しいコミュニケーション方法に戸惑うことも多くツールを導入したものの、利用しきれずに廃れていくことはよくあることです。筆者の組織で導入が上手く行えた理由は、ある程度のルールを定めていたこと（完全オープン、フラットな利用等）、chat普及推進者が地道にchatへの誘導やchatでの発言を促したことが大きいと考えます（普及のために社内ブログ記事を執筆したり、社内動画配信なども実施しました）。

ただ、このような情報共有を好まない人も組織には必ず居ます。私が取った方針は「相手にしない」でした。それが正しいかわかりませんが、どこに労力を割くべきか考えた結果、活性化の方に力を入れることにしました。

chatを組織に導入するためには、色々な苦労もありますが、苦労に見合った効果はあると信じています。より良いchatライフを。

## おわりに
今回の紹介は以上になります。
Mattermostは日本での利用事例も増えてきており、見つけ次第Twitterアカウント @mattermost_jp で紹介をしていますので、是非フォローをお願いします。

次号からは本格的にMattermostの便利な使い方や連携機能について紹介していきます。
